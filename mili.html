<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MILI</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    /* 🔹 Pantalla de login con degradado + imagen */
    #loginScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 9999;
      background: linear-gradient(135deg, #0d0221, #3a0ca3, #7209b7, #f72585);
    }

    /* Imagen de fondo */
    #loginScreen::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url("https://github.com/jgalindoduvan-hue/MILY/blob/main/ChatGPT%20Image%2019%20sept%202025%2C%2010_17_37%20a.m..png?raw=true") no-repeat center;
      background-size: contain;
      z-index: -1;
    }

    /* 🔹 Caja de login */
    #loginBox {
      position: absolute;
      top: 180px;
      left: 220px;
      background: rgba(0, 0, 0, 0.65);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      width: 260px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
    }

    #loginBox h2 {
      color: white;
      margin-bottom: 15px;
    }

    #loginBox input {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 5px;
    }

    #loginBox button {
      background: #ff3399;
      border: none;
      padding: 10px 20px;
      color: white;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }

    #loginBox button:hover {
      background: #e60073;
    }

    #error { color: red; display: none; }

    /* Ocultar contenido hasta login */
    #mainContent { display: none; }

    /* 🔹 Header */
    header {
      background: linear-gradient(90deg, #ff66cc, #ff3399);
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    header h1 {
      margin: 0;
      font-size: 1.5em;
      font-weight: bold;
      letter-spacing: 2px;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    nav img {
      height: 80px;
      cursor: pointer;
      display: inline-block;
      background: transparent;
      transition: transform 180ms ease, filter 180ms ease;
      will-change: transform, filter;
      animation: neonPulse 2.2s infinite alternate;
    }

    nav img:hover {
      transform: scale(1.08) rotate(-1.5deg);
      animation: neonPulse 2.2s infinite alternate, shake 0.36s linear;
    }

    @keyframes neonPulse {
      0% { filter: drop-shadow(0 0 2px #ff4da6) drop-shadow(0 0 4px #ffb3d6); }
      50% { filter: drop-shadow(0 0 4px #ff66cc) drop-shadow(0 0 8px #ff99cc); }
      100% { filter: drop-shadow(0 0 6px #ff1a8c) drop-shadow(0 0 10px #ff8fcf); }
    }

    @keyframes shake {
      0% { transform: scale(1.08) translate(0px, 0px) rotate(-1.5deg); }
      25% { transform: scale(1.08) translate(1px, -1px) rotate(-2.2deg); }
      50% { transform: scale(1.08) translate(-1px, 2px) rotate(-0.6deg); }
      75% { transform: scale(1.08) translate(2px, 1px) rotate(-1.8deg); }
      100% { transform: scale(1.08) translate(0px, 0px) rotate(-1.5deg); }
    }

    /* 🔹 Layout principal */
    main {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      padding: 20px;
    }

    section, aside {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    aside {
      min-height: 200px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* 🔹 Sidebar izquierda */
    .sidebar {
      position: fixed;
      top: 60%;
      left: 10px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 1000;
    }

    .sidebar img {
      width: 50px;
      cursor: pointer;
      transition: transform 0.2s ease, filter 0.2s ease;
      animation: neonPulse 2.2s infinite alternate;
    }

    .sidebar img:hover {
      transform: scale(1.1) rotate(-2deg);
      animation: neonPulse 2.2s infinite alternate, shake 0.36s linear;
    }

    /* Responsive */
    @media (max-width: 768px) {
      main { grid-template-columns: 1fr; }
      nav { justify-content: center; }
      nav img { height: 60px; }
      .sidebar img { width: 40px; }
      #loginBox { left: 50px; top: 140px; }
    }
  </style>
</head>
<body>
  <!-- 🔹 Pantalla de login -->
  <div id="loginScreen">
    <div id="loginBox">
      <h2 id="formTitle">Iniciar Sesión</h2>
      <input type="email" id="email" placeholder="Correo electrónico">
      <input type="password" id="password" placeholder="Contraseña">
      <input type="text" id="newUsername" placeholder="Nombre de usuario" style="display:none;">
      <button id="loginBtn">Iniciar Sesión</button>
      <button id="registerBtn" style="display:none;">Registrar</button>
      <p class="toggle" id="toggleForm" style="color:#ff99cc; cursor:pointer;">¿No tienes cuenta? Regístrate aquí</p>
      <p id="error">Usuario o contraseña incorrectos</p>
    </div>
  </div>

  <!-- 🔹 Contenido principal -->
  <div id="mainContent">
    <header>
      <h1>✨ MILI ✨</h1>
      <nav>
        <img src="https://raw.githubusercontent.com/jgalindoduvan-hue/MILY/main/INICIO.png?raw=true" alt="Inicio" onclick="showSection('home')">
        <img src="https://raw.githubusercontent.com/jgalindoduvan-hue/MILY/main/SORTEOS-removebg-preview.png?raw=true" alt="Sorteos" onclick="showSection('sorteo')">
        <img src="https://raw.githubusercontent.com/jgalindoduvan-hue/MILY/main/MOMENTOS-removebg-preview%20(1).png?raw=true" alt="Momento de Mili" onclick="showSection('mili')">
      </nav>
    </header>

    <!-- Sidebar -->
    <div class="sidebar">
      <a href="https://www.instagram.com/mily_s_15?igsh=NDdrMHZ3OXpjN2Q=" target="_blank">
        <img src="https://github.com/jgalindoduvan-hue/MILY/blob/main/INSTAGRAM.png?raw=true" alt="Instagram">
      </a>
      <a href="https://www.tiktok.com/@milysnow_?_t=ZS-8zrK9lRIMsb&_r=1" target="_blank">
        <img src="https://github.com/jgalindoduvan-hue/MILY/blob/main/TIK%20TOK.png?raw=true" alt="TikTok">
      </a>
      <a href="https://chat.whatsapp.com/CtcdiAwCKRmI0X2LIG0kO2?mode=ems_copy_t" target="_blank">
        <img src="https://github.com/jgalindoduvan-hue/MILY/blob/main/WHAT.png?raw=true" alt="WhatsApp">
      </a>
    </div>

    <main>
      <section id="contentArea">
        <h2>Bienvenido</h2>
        <p id="welcomeMsg"></p>
        <p id="roleMsg"></p>
      </section>
      <aside>
        🎥 Aquí irá el video o animación
      </aside>
    </main>
  </div>

  <!-- 🔹 Firebase + Login/Register -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Configuración Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBmsNMCASkrkNNgRndh8avKSVlfvUmnGAE",
      authDomain: "mili-de743.firebaseapp.com",
      projectId: "mili-de743",
      storageBucket: "mili-de743.firebasestorage.app",
      messagingSenderId: "662097238480",
      appId: "1:662097238480:web:a66880f01638aa5722c1d5",
      measurementId: "G-N3P79PWKZ2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");
    const toggleForm = document.getElementById("toggleForm");
    const formTitle = document.getElementById("formTitle");
    const newUsernameInput = document.getElementById("newUsername");

    let isRegister = false;

    // Alternar Login / Registro
    toggleForm.addEventListener("click", () => {
      isRegister = !isRegister;
      if (isRegister) {
        formTitle.innerText = "Registrar Usuario";
        newUsernameInput.style.display = "block";
        loginBtn.style.display = "none";
        registerBtn.style.display = "block";
        toggleForm.innerText = "¿Ya tienes cuenta? Inicia sesión aquí";
      } else {
        formTitle.innerText = "Iniciar Sesión";
        newUsernameInput.style.display = "none";
        loginBtn.style.display = "block";
        registerBtn.style.display = "none";
        toggleForm.innerText = "¿No tienes cuenta? Regístrate aquí";
      }
    });

    // Iniciar sesión
    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const error = document.getElementById("error");
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        const ref = doc(db, "users", uid);
        const snap = await getDoc(ref);

        let role = "user";
        let username = email;
        if (snap.exists()) {
          role = snap.data().role;
          username = snap.data().username || email;
        }

        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
        document.getElementById("welcomeMsg").innerText = "Hola, " + username + " 👋";
        document.getElementById("roleMsg").innerText = role === "admin"
          ? "Has ingresado como Administrador ✅"
          : "Has ingresado como Usuario 👤";
      } catch (err) {
        console.error(err);
        error.style.display = "block";
      }
    });

    // Registrar
    registerBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const username = newUsernameInput.value;
      if (!username) {
        alert("Por favor ingresa un nombre de usuario");
        return;
      }
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        await setDoc(doc(db, "users", uid), {
          email: email,
          username: username,
          role: "user",
          createdAt: new Date()
        });

        alert("Usuario registrado ✅ Ahora inicia sesión");
        formTitle.innerText = "Iniciar Sesión";
        newUsernameInput.style.display = "none";
        loginBtn.style.display = "block";
        registerBtn.style.display = "none";
        toggleForm.innerText = "¿No tienes cuenta? Regístrate aquí";
      } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
      }
    });

    // Cambiar secciones
    window.showSection = function(section) {
      const content = document.getElementById("contentArea");
      if (section === "home") {
        content.innerHTML = "<h2>Inicio</h2><p>Bienvenido al sistema de sorteo 🎉</p>";
      } else if (section === "sorteo") {
        content.innerHTML = "<h2>Sorteos</h2><p>Aquí estará la ruleta del sorteo.</p>";
      } else if (section === "mili") {
        content.innerHTML = "<h2>Momento de Mili</h2><p>Sección especial de Mili 💜</p>";
      }
    }
  </script>
</body>
</html>
